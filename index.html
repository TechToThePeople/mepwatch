<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="initial-scale=1, shrink-to-fit=no, width=device-width" name="viewport">

    <!-- CSS -->
    <link href="dist/css/fonts.css" rel="stylesheet">
    <link href="dist/css/main.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <div class="collapse bg-primary-light" id="navbarHeader">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 col-md-7 py-4">
              <h4 class="">About</h4>
              <p class="">
              </p>
            </div>
            <div class="col-sm-4 offset-md-1 py-4">
              <h4 class="">Contact</h4>
              <ul class="list-unstyled">
                <li><a href="https://twitter.com/eucampaign" class="">Follow on Twitter</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="navbar navbar-dark bg-primary box-shadow">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <i class="material-icons">blur_on</i>Project
          </a>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header>

    <main role="main">

      <section class="jumbotron text-center">
        <div class="container">
          <h1 class="jumbotron-heading">Select the votes you want to analyse</h1>
          <p class="lead text-muted"><form id="search"></form></p>
          <p>
            <a href="#" class="btn btn-primary">Need it?</a>
            <a href="#" class="btn btn-secondary">Do not</a>
          </p>
        </div>
      </section>
     <div class="py-5 bg-light">
        <div class="container-fluid">

          <div class="row">
            <div class="col-md-4">
              <div class="card mb-4 box-shadow">
                <div class="card-body">
                  <h5 class="card-title text-muted text-right">Card title</h5>
                  <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                      <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
                      <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
                    </div>
                    <small class="text-muted">Extra</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

          <div class="row">
            <div class="col-md-12">
            <table class="table table-stripped">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            </div>
          </div>
    </main>

    <footer class="text-muted">
      <div class="container">
        <p class="float-right">
          <a href="#">Back to top</a>
        </p>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <script src="dist/js/main.js"></script> 
    <script src="dist/js/dcbundle.js"></script>
<script>
  'use strict';
  var ndx=null;
  var graphs={};
  var dateParse = d3.timeParse("%Y-%m-%dT%H:%M:%S");
  var dateFormat = d3.timeFormat("%Y-%m-%d %H:%M:%S");
  //d3.csv('data/ep_votes.csv',function(d){
  d3.csv('data/8term.csv',function(d){
    d.date=dateParse(d.date);
    ["for","against","abstain","id"].forEach(function(i) {
      d[i]= +d[i] || "";
    });
    return d;
  })
  .then(function(d){
    console.log(d[0]);
    ndx = crossfilter(d);
    draw();
  });
   
  function draw(){
    graphs.table=drawTable('table.table');
    graphs.search=drawSearch("form#search");

    dc.renderAll();
  }

  function drawSearch(dom){
    var dim=ndx.dimension(function(d) {return d.report.toLowerCase()+" "+ d.title.toLowerCase()});
    var filter = function (query) {
//        query = _normalize(query);
        return function (d) {
            return d.indexOf(query) !== -1;
        };
    };
    var chart=dc.textFilterWidget(dom)
      .placeHolder("search by name")
      .filterFunctionFactory(filter)
      .dimension(dim);
    return chart;
  }

  function drawTable(dom){
    var dim = ndx.dimension(function(d) {
      return d.id
    });
    var graph = dc.dataTable(dom)
      .dimension(dim)
      .size(1000)
      .sortBy(function(d) {
        return d.date;
      })
      .order (d3.descending)
      .showGroups(false)
      .group(function(d) {
        return null;
      })
      .columns([
        function(d){ return d.id;}
        ,function(d) {
          return dateFormat(d.date);
        }
        ,function(d){ return d.report;}
        ,function(d){ return d.title;}
        ,function(d){ return d.type;}
        ,function(d){ return d.for;}
        ,function(d){ return d.against;}
        ,function(d){ return d.abstain;}
    ]);
    return graph;
  }

</script>
  </body>
</html>
