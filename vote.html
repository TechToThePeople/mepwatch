<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="initial-scale=1, shrink-to-fit=no, width=device-width" name="viewport">

    <!-- CSS -->
    <link href="dist/css/fonts.css" rel="stylesheet">
    <link href="dist/css/main.css" rel="stylesheet">

    <link rel="prefetch" href="data/meps.csv" as="fetch"/>

<style>

html .bg-info {
background-image: linear-gradient(-20deg, #6e45e2 0%, #88d3ce 100%);
}

.resetall button {padding:5px 0;min-width:3rem;font-size:0.9em}
.glyphicon-sort:after{ content:'⇅';}
.glyphicon-arrow-up:after{ content:'⤒';}
.glyphicon-arrow-down:after{ content:'⤓';}

.flag-icon {fill:pink; width:24px;height:16px;}
th .glyphicon {margin-left:5px;color:black;
  font-size:1.3em;
  border:1px solid grey;text-align:center;width:1.3em;border-radius:2px;display:inline-block;}

th#country,th#eugroup {min-width:100px;
  padding-right:0.75rem;padding-left: 0.75rem;}

    .icon,
    .eugroup,
    .country-flag {
      display: inline-block;
      width: 25px;
      height: 20px;
      text-indent: 100%;
      white-space: nowrap;
      overflow: hidden;
      background-size: cover;
      background-position:center;
    }

    .ppe {
      background-image: url("img/group/EPP.png");
    }

    .s-d {
      background-image: url("img/group/S-D.png");
    }

    .alde {
      background-image: url("img/group/ALDE.png");
    }

    .verts-ale {
      background-image: url("img/group/VERT.png");
    }

    .efdd {
      background-image: url("img/group/EFDD.png");
    }

    .gue-ngl {
      background-image: url("img/group/GUE.png");
    }

    .enf {
      background-image: url("img/group/ENF.png");
    }

    .ecr {
      background-image: url("img/group/ECR.png");
    }

    .na-ni {
      background-image: url("img/group/NA.png");
    }

    .austria {
      background-image: url("img/country/at.svg");
    }

    .belgium {
      background-image: url("img/country/be.svg");
    }

    .bulgaria {
      background-image: url("img/country/bg.svg");
    }

    .croatia {
      background-image: url("img/country/hr.svg");
    }

    .cyprus {
      background-image: url("img/country/cy.svg");
    }

    .czech-republic {
      background-image: url("img/country/cz.svg");
    }

    .denmark {
      background-image: url("img/country/dk.svg");
    }

    .estonia {
      background-image: url("img/country/ee.svg");
    }

    .finland {
      background-image: url("img/country/fi.svg");
    }

    .france {
      background-image: url("img/country/fr.svg");
    }

    .germany {
      background-image: url("img/country/de.svg");
    }

    .greece {
      background-image: url("img/country/el.svg");
    }

    .hungary {
      background-image: url("img/country/hu.svg");
    }

    .ireland {
      background-image: url("img/country/ie.svg");
    }

    .italy {
      background-image: url("img/country/it.svg");
    }

    .latvia {
      background-image: url("img/country/lv.svg");
    }

    .lithuania {
      background-image: url("img/country/lt.svg");
    }

    .luxembourg {
      background-image: url("img/country/lu.svg");
    }

    .malta {
      background-image: url("img/country/mt.svg");
    }

    .netherlands {
      background-image: url("img/country/nl.svg");
    }

    .poland {
      background-image: url("img/country/pl.svg");
    }

    .portugal {
      background-image: url("img/country/pt.svg");
    }

    .romania {
      background-image: url("img/country/ro.svg");
    }

    .slovakia {
      background-image: url("img/country/sk.svg");
    }

    .slovenia {
      background-image: url("img/country/si.svg");
    }

    .spain {
      background-image: url("img/country/es.svg");
    }

    .sweden {
      background-image: url("img/country/se.svg");
    }

    .united-kingdom {
      background-image: url("img/country/gb.svg");
    }

</style>
  </head>
  <body>
    <header>
      <div class="collapse bg-primary-light" id="navbarHeader">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 col-md-7 py-4">
              <h4 class="">About</h4>
              <p class="">
              </p>
            </div>
            <div class="col-sm-4 offset-md-1 py-4">
              <h4 class="">Contact</h4>
              <ul class="list-unstyled">
                <li><a href="https://twitter.com/eucampaign" class="">Follow on Twitter</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="navbar navbar-dark bg-primary box-shadow">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <i class="material-icons">blur_on</i><span class="rapporteur">Vote</span>
          </a>
          <span class="date">YYYY-mm-DD</span>
          <span class="report">A8-XXXX/20YY</span>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header>

    <main role="main">

      <section class="jumbotron text-center">
        <div class="container">
          <h2 class="jumbotron-heading">Vote to analyse 92926</h2>
          <h3 class="jumbotron-heading">Vote to analyse 92926</h3>
        </div>
      </section>
     <div class="py-5 bg-info">
        <div class="container-fluid">

          <div class="row">
            <div class="col-md-3">
          <form id="search"></form>
          <ul class="list-group">
            <li class="list-group-item nbmep"><a class="resetall"><span class="nb"></span> MEPs<button type="button" class="btn btn-warning float-right" title="reset the filters">↺</button></a></li> 
            <li class="list-group-item nbvoted"><span class="percent badge badge-primary badge-pill float-right">%</span><span class="nb"></span> voted</li> 
            <li class="list-group-item result"><span class="percent badge badge-primary badge-pill float-right"></span><span class="nb"></span> result</li> 
          </ul>
            </div>
            <div class="col-md-3" id="result">
                  <div class="graph"></div>
            </div>
            <div class="col-md-3" id="eugroup">
                  <div class="graph"></div>
            </div>
          </div>
        </div>
     </div>
     <div class="py-5 bg-light">
        <div class="container-fluid">

          <div class="row">
            <div class="col-md-12">
              <div class="card box-shadow" id="country">
                <div class="card-body">
                  <h5 class="card-title text-muted text-right">
                  <button type="button" class="btn-relative btn btn-primary" title="percentage of votes">Percentage</button>
                  <button type="button" class="btn-absolute active btn btn-primary" title="Number of votes">Number</button>
                  </h5>
                  <div class="graph"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

          <div class="row">
            <div class="col-md-12">
            <table class="table table-stripped">
              <thead>
                <tr>
                  <th>Vote</th>
                  <th>Name</th>
                  <th>Country</th>
                  <th>Party</th>
                  <th>Group</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            </div>
          </div>
    </main>

    <footer class="text-muted">
      <div class="container">
        <p class="float-right">
          <a href="#">Back to top</a>
        </p>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <script src="dist/js/main.js"></script> 
    <script src="dist/js/dcbundle.js"></script>
<script>
  'use strict';
  var ndx=null;
  var graphs={};
  var q=d3.queue();
  var meps= [];
  var votes= [];
  var config = {};

  var voteid= Number(urlParam("v") || 92926);
  var results = "for,against,abstention,no show,excused,attended".split(",");
  var countries = { "Belgium": "be", "Bulgaria": "bg", "Czech Republic": "cz", "Denmark": "dk", "Germany": "de", "Estonia": "ee", "Ireland": "ie", "Greece": "gr", "Spain": "es", "France": "fr", "Croatia": "hr", "Italy": "it", "Cyprus": "cy", "Latvia": "lv", "Lithuania": "lt", "Luxembourg": "lu", "Hungary": "hu", "Malta": "mt", "Netherlands": "nl", "Austria": "at", "Poland": "pl", "Portugal": "pt", "Romania": "ro", "Slovenia": "si", "Slovakia": "sk", "Finland": "fi", "Sweden": "se", "United Kingdom": "gb","Europe": "eu"};
 
  var iconify = function(name,prefix) {
    prefix = prefix || "icon";
    return '<svg class="icon" class="'+name+'"><title>'+name+'</title><use href="#'+prefix+'-'+name+'" /></svg>';
  }
  var resultscolor= d3.scaleOrdinal()
	.domain(results)
	.range("#27ae60,#d35400,#2980b9,#95a5a6,#34495e,#bdc3c7".split(","));
  var percentagecolor=d3.scaleLinear()
    .domain([0,49,50,51,100])
    .range(["#27ae60","#C8E6C9","#9E9E9E","#ffcdd2","#d35400"])
    .interpolate(d3.interpolateHcl);

  var dateParse = d3.timeParse("%Y-%m-%d");
  var dateTimeParse = d3.timeParse("%Y-%m-%d %H:%M:%S");
  var dayFormat = d3.timeFormat("%Y-%m-%d");
  var dateFormat = d3.timeFormat("%Y-%m-%d %H:%M:%S");
  var formatPercent = d3.format(".0%");
  var week = d3.timeFormat("%V");
  //d3.csv('data/ep_votes.csv',function(d){
  q
  .defer(dl_meps)
  .defer(dl_details)
  .defer(dl_votes)
  .awaitAll(function(error,r){
    if (error) throw error;
    var length=votes.length;
    var meps=r[0];//first deferred download
    for (var j=0; j < meps.length;j++) {
      var m=meps[j];
      if (!m) console.log(j);
      if (m.start > config.date) {
        meps.splice(j,1);
        j--;
        continue;
      }
      if (m.end && m.end < config.date) {
        meps.splice(j,1);
        j--;
        continue;
      }
      for (var i=0; i < length;i++) {
        if (votes[i].mepid == m.voteid){
          meps[j].vote=votes[i].result;
          votes[i].processed=true;
//          votes.splice(i,1);
          break;
        }
      };
      if (!meps[j].vote) {
        meps[j].vote = "no show";
      }
    };
    //TODO: handle this properly, this is a big problem
    var errors = [];
    votes.map(function(v){if (!v.processed) errors.push(v)});
    if (errors.length){
      d3.select("main").insert("div",":first-child").attr("class","alert alert-danger")
        .html("<h1>They are votes that we couldn't process. Contact Xavier</h1>");
      console.log (errors);
    }
    config.nb=meps.length;

    ndx = crossfilter(meps);
    draw();
  });

  d3.svg("img/eu-flags.svg").then(function(xml) {
    document.body.appendChild(xml.documentElement);
  });


  function dl_details(callback) {
    d3.json('cards/'+voteid+'.json').then(function(d) {
      d.date = dateTimeParse(d.date);
      config=d;
      $('h2').html(config.name);
      $('.navbar .rapporteur').html(config.rapporteur);
      $('.navbar .date').html(dateFormat(config.date));
      $('.navbar .report').html(config.report);
      $('h3').html(config.desc);
      callback(null);
    });
  }
  function dl_votes (callback){
    d3.csv('cards/'+voteid+'.csv',function(d){
      d.mepid= +d.mepid;
      d.identifier= +d.identifier;
      return d;
    }).then(function(d){
      votes=d;
      callback(null);
    });
  };

  function dl_meps (callback){
    d3.csv('data/meps.csv',function(d){
//      d.date=dateParse(d.date.substring(0,10));
//      if (!d.date) {console.log(d)};
      d.voteid= +d.voteid;
      d.epid= +d.epid;
      d.active= (d.active == "true");
      d.birthdate=dateParse(d.birthdate);
      d.start=dateParse(d.start);
      d.end=d.end == ""? null:dateParse(d.end);
      return d;
    })
    .then(function(d){
//      draw();
      callback(null,d);
    });
  };

    d3.select(window).on('resize.updatedc', function() {
      dc.events.trigger(function() {
        dc.chartRegistry.list().forEach(function(chart) {
          var container = chart.root().node();
          if (!container) return; // some graphs don't have a node (?!)
          container = container.parentNode.getBoundingClientRect();
          chart.width(container.width);
          chart.rescale && chart.rescale(); // some graphs don't have a rescale
        });

        dc.redrawAll();
      }, 500);
    });

  dc.config.defaultColors(d3.schemeCategory10);

  function draw(){
//    graphs.date=drawDate('#date div.graph');
//    graphs.report=drawReport('#report div.graph');
    graphs.country=drawCountry('#country div.graph');
    graphs.group=drawGroup('#eugroup div.graph');
    graphs.table=drawTable('table.table');
    drawNumbers(graphs);
    graphs.result=drawResult('#result .graph');
    graphs.search=drawSearch("form#search");

    dc.renderAll();
  }

   function drawGroup(dom) {
     var eu_groups = {
      "GUE/NGL": "#800c00",
      "S&D": "#c21200",
      "Verts/ALE": "#05a61e",
      "Greens/EFA": "#05a61e",
      "ALDE": "#ffc200",
      "EFDD": "#5eced6",
      "PPE": "#0a3e63",
      "EPP": "#0a3e63",
      "ECR": "#3086c2",
      "NA/NI": "#cccccc",
      "NA,NI": "#cccccc",
      "ENF": "#A1480D",
      "Array": "pink"
     };

      var graph = dc.sunburstChart(dom).innerRadius(10);//.radius(70);
      var dim = ndx.dimension(function(d) {
        return [d.eugroup,d.party];
      });
      var reducer = reductio();
      var res=results.slice();
      reducer.value("nb").count(true);
      res.forEach(function(r){
        reducer.value(r).count(true).filter(function(d){ return d.vote == r});
      });

      var group = dim.group();
      reducer(group);
      //var group = dim.group().reduceSum(function(d) {return 1;});
      graph
        .width(0)
        .height(0)
        .colorCalculator(function(d, i) {
          return eu_groups[d.data.path[0]];
        })
        .valueAccessor(function(d){return d.value.nb.count})
        .dimension(dim)
        .group(group)
//        .externalLabels(-26)
        .minAngleForLabel(0.4);
//        .legend(dc.legend().horizontal(true).autoItemWidth(true).y(200));
      return graph;
    }

  function drawResult(dom) {
    var graph = dc.pieChart(dom).innerRadius(40) //.radius(70);
    var dim = ndx.dimension(function(d) {
      return d.vote || "?";
    });
    var group = dim.group().reduceSum(function(d) {
      return 1;
    });
    graph
      .width(0)
      .height(0)
      .ordering(function(d){ return results.indexOf(d.key) >=0 ?  results.indexOf(d.key) : 1984})
      .colors(resultscolor)
/*      .colorCalculator(function(d, i) {
        return eu_groups[d.key];
        //return color(d.value.score/d.value.count);
      })
    */
      .on("filtered", function(c){
          var mode=(graphs.result.filters().length == 1 ? "absolute":"relative");
          d3.select("#country .btn-"+mode).dispatch("click");
        })
      .dimension(dim)
      .group(group)
      .externalLabels(-26)
      .minAngleForLabel(0.2);
//        .legend(dc.legend().horizontal(true).autoItemWidth(true).y(200));
    return graph;
  }

    function drawCountry(dom) {
      var dim = ndx.dimension(function(d) {return d.country;});
      var reducer = reductio();
      var res=results.slice();
      reducer.value("nb").count(true);
      res.forEach(function(r){
        reducer.value(r).count(true).filter(function(d){ return d.vote == r});
      });

      var group = dim.group();
      reducer(group);

      var graph = dc.barChart(dom);
      graph.relative=true;

      function getValue(result){
        if (graph.relative)
          return function(d){return d.value[result].count/d.value.nb.count*100; }
        return function(d){
          return d.value[result].count; }
      }

      graph
        .width(0)
        .height(186)
        .outerPadding(0)
        .gap(0)
        .margins({
          top: 0,
          right: 10,
          bottom: 20,
          left: 30
        })
        .ordering(function(d){ return -d.value.for.count/d.value.nb.count})
        .x(d3.scaleBand())
        .xUnits(dc.units.ordinal)
        .colors(resultscolor)
        .brushOn(false)
        .title(function(d) {
          if (this.layer == 0) return "";
          return d.key +  " voting '"+ this.layer + "': " + d.value[this.layer].count +" ("+formatPercent(d.value[this.layer].count/d.value.nb.count)+")";
        })

        .elasticY(true)
        .yAxisLabel("%MEPs")
        .dimension(dim)
//        .group(group, "for", getValue("for")) bug: doesn't switch properly between absolute and relative
        .group(group, "", 0)
        .on("renderlet", function(c) {
          rotateBarChartLabels();
          if (!d3.select("#country .axis.x use").empty()) return;
          d3.select("#country .axis.x").selectAll(".tick")
            .append("use").attr( "href",function(d){
            return '#flag-'+countries[d]}).attr("width",24).attr("height",16)
            .attr("transform","translate(-10,2)");
        });
      graph.xAxis().ticks(3);
//      res.shift();
      res.forEach(function(r){
        graph.stack(group, r, function(d){
          return getValue(r)(d);
        });
      });

      toggleMode ();

      return graph;

      function rotateBarChartLabels() {
        d3.selectAll(dom + ' .axis.x line').remove();
        d3.selectAll(dom + ' .axis.x text')
          .style("text-anchor", "start")
          .attr("transform", function(d) {
            return "rotate(-90, -4, 9), translate(10,0) ";
          });
      }

      function toggleMode (){
        d3.selectAll("#country h5 button").on("click",function(){
          var b=d3.select(this);
          if (!b.classed("active")) return;
          graph.relative= b.classed("btn-relative");
          b.classed("active",false);
          d3.select("#country .btn-"+(graph.relative?"absolute":"relative")).classed("active",true);
          graph.yAxisLabel((graph.relative?"%":"#")+"MEPs")
          graph.redraw();
        });
      }
    }

  function drawNumbers(graphs) {
    var dim = ndx.dimension(function(d) {
      return true;
    });

    var reducer = reductio();
    reducer.value("nb").count(true);
    reducer.value("woman").count(true).filter(function(d) {
      return d.Gender == "F"
    });
    var res=results.slice();
      reducer.value("nb").count(true);
    results.forEach(function(r){
      reducer.value(r).count(true).filter(function(d){ return d.vote == r});
    });

    var group = dim.group();
    reducer(group);

    graphs.total = dc.numberDisplay(".nbmep .nb")
      .group(group)
      .valueAccessor(function(d) {return d.value.nb.count})
      .formatNumber(d3.format("d"))
      .on("renderlet.linked",function(){
        var d=group.top(1)[0];
        var c = (d.value.nb.count == config.nb) ? "d-none":"btn btn-warning float-right btn-sm"; 
        d3.select(".nbmep button").attr("class",c);
      });
    d3.select(".resetall").on("click",function(){
      dc.filterAll();
      dc.renderAll();
    });

    graphs.total = dc.numberDisplay(".nbvoted .nb")
      .group(group)
      .valueAccessor(function(d) {return d.value.for.count+d.value.against.count+d.value.abstention.count})
      .formatNumber(d3.format("d"))
      .on("renderlet.linked",function(){
        var d=group.top(1)[0];
        d3.select(".result .nb").html(function(){
          if (d.value.for.count + d.value.against.count == 0) return "?";
          return iconify(d.value.for.count > d.value.against.count ? "for" : "against");
        });
        d3.select(".result .badge").html(function(){
          var sum=d.value.for.count + d.value.against.count;
          if (sum == 0) return "";
          return formatPercent(Math.max(d.value.for.count,d.value.against.count) / sum);
        })
        .style("background-color",function(){
          var sum=d.value.for.count + d.value.against.count;
          return percentagecolor(100*d.value.against.count/sum);
        });
        d3.select(".nbvoted .badge").html(function(){
          var sum=d.value.for.count + d.value.against.count + d.value.abstention.count;
          if (sum == 0 || sum == d.value.nb.count) return "";
          return formatPercent(sum / d.value.nb.count);
        });
      });
  }

  function drawReport(dom){
    var dim = ndx.dimension(function(d) {
      return d.epid;
    });


    var tip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([0, 10])
      .direction("e")
      .html(function(d) {
        console.log(docs[d.key]);
        return docs[d.key]? "<h3>"+docs[d.key].rapporteur+"</h3>"+docs[d.key].title +":"+ d.value: d.value;
//        return abbr(d.key) + "<br><b>" + d.value + " MEPs</b>&nbsp;<i>" + formatPercent(d.value/summary.total) +"</i>";
      });

    //var dim = ndx.dimension(function(d) {return d.report?d.report:"?";}, true);
    var dim = ndx.dimension(function(d) {return d.report? d.report : "?";});
    var group = dim.group().reduceSum(function(d) {
      return 1;
    });

    var graph = dc.rowChart(dom)
      .width(0)
      .height(300)
      //      .rowsCap(18)
//      .ordering(function(d) {  return -d.key      })
      .cap(10)
      .label (function(d){return docs[d.key]? docs[d.key].rapporteur : d.key})
      .renderTitle(false)
      .margins({
        top: 0,
        right: 0,
        bottom: 20,
        left: 0
      })
//      .ordinalColors([committee_color])
      .gap(0)
      .elasticX(true)
      .dimension(dim)
      .group(group)
      .on("renderlet.top", function(c) {
          c.selectAll("g.row")
            .call(tip)
            .on("mouseover.tip", tip.show)
            .on("mouseout.tip", tip.hide);
      });
    graph.xAxis().ticks(3);

    return graph;
  }

  function drawSearch(dom){
    var dim=ndx.dimension(function(d) {
      if (!d.firstname) console.log(d);
      return d.firstname.toLowerCase()+" "+ d.lastname.toLowerCase() + " " +d.party.toLowerCase() });
    var filter = function (query) {
//        query = _normalize(query);
        return function (d) {
            return d.indexOf(query.toLowerCase()) !== -1;
        };
    };
    var chart=dc.textFilterWidget(dom)
      .placeHolder("search by name")
      .filterFunctionFactory(filter)
      .dimension(dim);
    return chart;
  }

  function drawTable(dom){
    var dim = ndx.dimension(function(d) {
      return d.lastname;
    });
    var graph = dc.dataTable(dom)
      .dimension(dim)
      .size(1000)
      .sortBy(function(d) {
        return d.date;
      })
      .order (d3.ascending)
      .showGroups(false)
      .group(function(d) {
        return null;
      })
      .columns([
        function(d){ return d.vote;}
        ,function(d) {
          return d.firstname + " " + d.lastname;
        }
        ,function(d) {
            return "<span title='" + d.country + "' class='img-rounded text-filter country-flag " + d.country.replace(" ", "-").toLowerCase() + "'>" + d.country + "</span>";
          }
        ,function(d) {
            return "<span title='" + d.eugroup + "' class='img-rounded text-filter eugroup " + d.eugroup.replace(/&|\/|car/g, "-").toLowerCase() + "'>" + d.eugroup + "</span>";
          },
        ,function(d){ return d.party;}
    ]);

//    drawPagination();
    sortable(graph);

    return graph;

    function sortable(chart){
      var th = [
        {attr:function(d){return results.indexOf(d.vote)}}
        ,{attr:"last_name"}
        ,{attr:"country"}
        ,{attr:"eugroup"}
        ,{attr:"party"}
      ];
      d3.selectAll("th")
        .data(th)
        .attr("class",function(d) {if (d.attr) return "sortable";})
        .attr("id",function(d){ if (d.attr && typeof d.attr != "function") return d.attr});

      d3.selectAll("th.sortable")
      .on("click", function(d) {
        var icon=d3.select(this).select("i.glyphicon");
        var up=icon.classed("glyphicon-arrow-up");
        d3.selectAll("th.sortable .glyphicon").attr("class","glyphicon glyphicon-sort");
        if (!up) {
          icon.attr("class","glyphicon glyphicon-arrow-up");
          chart.order (d3.ascending);
        } else {
          icon.attr("class","glyphicon glyphicon-arrow-down");
          chart.order (d3.descending);
        }
        if (typeof d.attr == "function") {
          chart.sortBy(d.attr);
        } else {
          chart.sortBy(function (e){return e[d.attr];});
        }
        chart.redraw();
      })
     .append("i").attr('class','glyphicon glyphicon-sort');

     d3.select("th#last_name i").attr("class","glyphicon glyphicon-arrow-down");
   }
}

function urlParam(name,value) {
  if (value) {
    var uri=window.location.href;
    var re = new RegExp("([?&])" + name + "=.*?(&|#|$)", "i");
    if (uri.match(re)) {
    uri=uri.replace(re, '$1' + name + "=" + value + '$2');
    } else {
      var hash =  '';
      if( uri.indexOf('#') !== -1 ){
        hash = uri.replace(/.*#/, '#');
        uri = uri.replace(/#.*/, '');
      }
      var separator = uri.indexOf('?') !== -1 ? "&" : "?";
      uri= uri + separator + name + "=" + value + hash;
    }
    history.pushState({q:value},"search for "+value,uri);
    return uri;
  } else {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results == null) {
      return null;
    } else {
      return decodeURI(results[1]) || 0;
    }
  }
};

</script>

<svg>
  <symbol id="icon-against" viewBox="0 0 24 24">
    <path fill="#000000" d="M19,15H23V3H19M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14A2,2 0 0,0 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.77 8.33,20.88C8.33,21.3 8.5,21.67 8.77,21.94L9.83,23L16.41,16.41C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z" />
  </symbol>
  <symbol id="icon-for" viewBox="0 0 24 24">
    <path fill="#000000" d="M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z" />
  </symbol>
  <symbol id="icon-abstention" viewBox="0 0 24 24">
  <path id="up-down" fill="#000000" d="M22.5,10H15.75C15.13,10 14.6,10.38 14.37,10.91L12.11,16.2C12.04,16.37 12,16.56 12,16.75V18A1,1 0 0,0 13,19H18.18L17.5,22.18V22.42C17.5,22.73 17.63,23 17.83,23.22L18.62,24L23.56,19.06C23.83,18.79 24,18.41 24,18V11.5A1.5,1.5 0 0,0 22.5,10M12,6A1,1 0 0,0 11,5H5.82L6.5,1.82V1.59C6.5,1.28 6.37,1 6.17,0.79L5.38,0L0.44,4.94C0.17,5.21 0,5.59 0,6V12.5A1.5,1.5 0 0,0 1.5,14H8.25C8.87,14 9.4,13.62 9.63,13.09L11.89,7.8C11.96,7.63 12,7.44 12,7.25V6Z" />
  </symbol>
</svg>

  </body>
</html>
